<html>
  <body>
    <h1>ESP32 Web Server</h1>
    <p>Toggle State: <span id="state">{}</span></p>
    <button onclick="toggle()">Toggle</button>
    <script>
      // Function to fetch and update the state on the webpage
      async function updateState() {
        let response = await fetch("/state");
        let data = await response.json();
        document.getElementById("state").innerText = data.state;
      }

      // Function to toggle the state
      async function toggle() {
        // Send POST request to toggle the state
        await fetch("/toggle", { method: "POST" });

        // Add small delay to avoid overwhelming server
        await new Promise((resolve) => setTimeout(resolve, 300));

        // Fetch and update the current state after toggling
        await updateState();
      }

      // Periodically refresh the state every 5 seconds
      setInterval(updateState, 5000);

      // Call updateState initially to load the current state on page load
      updateState();
    </script>
  </body>
</html>
